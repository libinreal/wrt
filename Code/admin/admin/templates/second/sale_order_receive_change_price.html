<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>{$lang.cp_home} - 到货改价</title>
		<meta name="robots" content="noindex, nofollow">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<link href="styles/general.css" rel="stylesheet" type="text/css" />
		<link href="styles/main.css" rel="stylesheet" type="text/css" />
		<script src="../js/jquery-1.8.3.min.js" type="text/javascript" ></script>
	</head>
	<body>
		<h1>
		<span class="action-span1"><a href="index.php?act=main">{$lang.cp_home}</a> </span>
		<span id="search_id" class="action-span1">- 到货改价</span>
		<div style="clear:both"></div>
		</h1>
		<div id="message_area"></div>
		<div class="list-note-2">
			<table>
				<tbody>
				<tr><td class="title">订单资料</td></tr>
				<tr>
					<td colspan="20">
					<span class="head">订单编号：</span><span class="info" id="order_sn"></span>
					<span class="head">公司名称：</span><span class="info" id="user_name"></span>
					<span class="head">合同名称：</span><span class="info" id="contract_name"></span>
					<span class="head">合同号：</span><span class="info" id="contract_sn"></span>
					</td>
				</tr>
				<tr>
					<td colspan="20">
					<span class="head">下单人：</span><span class="info" id=""></span>
					<span class="head">下单时间：</span><span class="info" id="add_time"></span>
					<span class="head">订单状态：</span><span class="info" id="order_status"></span>
					</td>
				</tr>
				</tbody>
			</table>
		</div>
		<div class="list-note-2">
			<table cellpadding="3" cellspacing="1" id="bill_purchase_assign_list">
				<tbody>
				<tr><td class="title">开票资料</td></tr>
				<tr>
					<td colspan="20">
					<span class="head">发票类型：</span><span class="info" id="inv_type"></span>
					<span class="head">发票抬头：</span><span class="info" id="inv_payee"></span>
					<span class="head">内容：</span><span class="info" id=""></span>
					<span class="head">备注：</span><span class="info" id=""></span>
					</td>
				</tr>
				<tr>
					<td colspan="20">
					<span class="head">收货人：</span><span class="info" id="consignee"></span>
					<span class="head">收货地址：</span><span class="info" id="address"></span>
					<span class="head">手机号码：</span><span class="info" id="mobile"></span>
					<span class="head">地址标签：</span><span class="info" id="sign_building"></span>
					</td>
				</tr>
				</tbody>
			</table>
		</div>
		<div class="table_info">
			<form id="change_price_form">
			<table width="80%">
			<thead>
			<tr>
				<th colspan="20">客户价格</th>
			</tr>
			</thead>
			<tbody>
				<tr>
					<td></td><td></td>
					<td class="title">物料单价：</td>
					<td><input type="text" name="goods_price_add"></td>
					<td class="title">物料数量：</td>
					<td><input type="text" name="goods_number_arrival" data-rule-required="true" data-rule-number="true"></td>
				</tr>
				<tr>
					<td class="title">实际供应商：</td>
					<td><select name="suppers_id" style="width:80px;" onchange="SaleOrder.getSuppliersPrice()">
						<option value="">选择供应商</option>
					</select></td>
					<td class="title">金融费用比率：</td>
					<td><input type="text" name="financial_arr_rate" data-rule-required="true" data-rule-number="true"></td>
					<td class="title">物流费用：</td>
					<td><input type="text" name="shipping_fee_arr_buyer" data-rule-required="true" data-rule-number="true"></td>
				</tr>
				<tr>
					<td class="title">金融费用：</td>
					<td><input type="text" name="financial_arr" data-rule-required="true" data-rule-number="true"></td>
					<td class="title">发货总价：</td>
					<td><input type="text" name="order_amount_arr_buyer"></td>
					<td></td><td></td>
				</tr>
			</tbody>
			</table>
			<div>&nbsp;</div>
			<table width="80%">
			<thead>
			<tr>
				<th colspan="20">供应商价格</th>
			</tr>
			</thead>
			<tbody>
				<tr>
					<td class="title">物料单价：</td>
					<td><input type="text" name="goods_price"></td>
					<td class="title">物料数量：</td>
					<td><input type="text" name="goods_number"></td>
					<td class="title">物流费用：</td>
					<td><input type="text" name="shipping_fee_arr_saler" data-rule-required="true" data-rule-number="true"></td>
				</tr>
				<tr>
					<td class="title">付款方式：</td>
					<td><select name="pay_id" style="width:80px;">
					</select></td>
					<td class="title">发货总价：</td>
					<td><input type="text" name="order_amount_arr_saler"></td>
					<td></td><td></td>
				</tr>
			</tbody>
			</table>
			<input type="hidden" name="order_id" />
			</form>
		</div>
		<div>&nbsp;</div>
		<div align="center">
			<input type="button" class="button" value=" 保存 " onclick="SaleOrder.updatePriceArr();"> 
			<input type="button" class="button" value=" 取消 " onclick="javascript:history.back()">
		</div>
		<div>&nbsp;</div>
		<div class="list-div" id="listDiv">
			<h2>历史报价</h2>
			<table cellpadding="3" cellspacing="1" id="price_log_list">
				<thead>
				<tr>
					<th>物料代码</th>
					<th>物料名称</th>
					<th>规格/型号/材质</th>
					<th>供应商</th>
					<th>供应商报价</th>
					<th>实际单价</th>
					<th>物流费用</th>
					<th>金融费用</th>
					<th>总金额</th>
					<th>支付方式</th>
					<th>报价日期</th>
				</tr>
				</thead>
				<tbody></tbody>
			</table>
		</div>
		
		<!-- 底部 -->
		<div id="footer">
			{$lang.copyright}
		</div>

<script src="js/jquery.validate.js" type="text/javascript" ></script>
<script src="js/ajax.js" type="text/javascript" ></script>
<script src="js/sale-order.js" type="text/javascript" ></script>
<script type="text/javascript">
SaleOrder.initPriceArr();
$(document).ready(function(){
	// 客户价格-物料单价修改
	$('#goods_price_send_buyer').on('valuechange', function (e, previous) {
		var price = validateNumber(parseFloat($("#goods_price_send_buyer").val())) == 0 ? 0 : parseFloat($("#goods_price_send_buyer").val());
		var number = validateNumber(parseFloat($("#goods_number_send_buyer").val())) == 0 ? 0 : parseFloat($("#goods_number_send_buyer").val());
		var rate = validateNumber(parseFloat($("#financial_send_rate").val())) == 0 ? 0 : parseFloat($("#financial_send_rate").val());;
		var contract_sn = $("#contract_sn").text();
		var financial_send = validateNumber(parseFloat($("#financial_send").val())) == 0 ? 0 : parseFloat($("#financial_send").val());
		if(financial_send == 0){
			SaleOrder.getFinaceFee(price, number, rate, contract_sn, 'customerPriceChange');
		}else{
			customerPriceChange(financial_send);
		}
	});
	// 客户价格-物料数量修改
	$('#goods_number_send_buyer').on('valuechange', function (e, previous) {
		var price = validateNumber(parseFloat($("#goods_price_send_buyer").val())) == 0 ? 0 : parseFloat($("#goods_price_send_buyer").val());
		var number = validateNumber(parseFloat($("#goods_number_send_buyer").val())) == 0 ? 0 : parseFloat($("#goods_number_send_buyer").val());
		var rate = validateNumber(parseFloat($("#financial_send_rate").val())) == 0 ? 0 : parseFloat($("#financial_send_rate").val());;
		var contract_sn = $("#contract_sn").text();
		var financial_send = validateNumber(parseFloat($("#financial_send").val())) == 0 ? 0 : parseFloat($("#financial_send").val());
		if(financial_send == 0){
			SaleOrder.getFinaceFee(price, number, rate, contract_sn, 'customerPriceChange');
		}else{
			customerPriceChange(financial_send);
		}
	});
	// 客户价格-金融费用比率修改
	$('#financial_send_rate').on('valuechange', function (e, previous) {
		var price = validateNumber(parseFloat($("#goods_price_send_buyer").val())) == 0 ? 0 : parseFloat($("#goods_price_send_buyer").val());
		var number = validateNumber(parseFloat($("#goods_number_send_buyer").val())) == 0 ? 0 : parseFloat($("#goods_number_send_buyer").val());
		var rate = validateNumber(parseFloat($("#financial_send_rate").val())) == 0 ? 0 : parseFloat($("#financial_send_rate").val());;
		var contract_sn = $("#contract_sn").text();
		var financial_send = validateNumber(parseFloat($("#financial_send").val())) == 0 ? 0 : parseFloat($("#financial_send").val());
		if(financial_send == 0){
			SaleOrder.getFinaceFee(price, number, rate, contract_sn, 'customerPriceChange');
		}else{
			customerPriceChange(financial_send);
		}
	});
	// 客户价格-物流费用改价
	$('#shipping_fee_send_buyer').on('valuechange', function (e, previous) {
		var financial_send = validateNumber(parseFloat($("#financial_send").val())) == 0 ? 0 : parseFloat($("#financial_send").val());
		customerPriceChange(financial_send);
	});
	// 供应商价格 - 物料单价修改
	$('#goods_price_send_saler').on('valuechange', function (e, previous) {
		supplierPriceChange()
	});
	// 供应商价格 - 物料数量修改
	$('#goods_number_send_saler').on('valuechange', function (e, previous) {
		supplierPriceChange()
	});
	// 供应商价格 - 物流费用
	$('#shipping_fee_send_saler').on('valuechange', function (e, previous) {
		supplierPriceChange()
	});
});
// 客户价格 - 价格更新
function customerPriceChange(finance){
	// 客户价格-金融费用比率
	var financial_send_rate = validateNumber(parseFloat($("#financial_send_rate").val())) == 0 ? 0 : parseFloat($("#financial_send_rate").val());
	// 客户价格-物料单价
	var goods_price_send_buyer = validateNumber(parseFloat($("#goods_price_send_buyer").val())) == 0 ? 0 : parseFloat($("#goods_price_send_buyer").val());
	// 物料数量
	var goods_number_send_buyer = validateNumber(parseFloat($("#goods_number_send_buyer").val())) == 0 ? 0 : parseFloat($("#goods_number_send_buyer").val());
	// 客户价格-金融费用
	var financial_send = finance;
	$("#financial_send").val(finance);
	// 客户价格-物流费用
	var shipping_fee_send_buyer = validateNumber(parseFloat($("#shipping_fee_send_buyer").val())) == 0 ? 0 : parseFloat($("#shipping_fee_send_buyer").val());
	// 客户价格-发货总价
	$("#order_amount_send_buyer").val(goods_price_send_buyer*goods_number_send_buyer + shipping_fee_send_buyer + financial_send);
}
// 供应商价格 - 价格更新
function supplierPriceChange(){
	// 供应商价格 - 物料单价
	var goods_price_send_saler = validateNumber(parseFloat($("#goods_price_send_saler").val())) == 0 ? 0 : parseFloat($("#goods_price_send_saler").val());
	// 供应商价格 - 物料数量
	var goods_number_send_saler = validateNumber(parseFloat($("#goods_number_send_saler").val())) == 0 ? 0 : parseFloat($("#goods_number_send_saler").val());
	// 供应商价格 - 物流费用
	var shipping_fee_send_saler = validateNumber(parseFloat($("#shipping_fee_send_saler").val())) == 0 ? 0 : parseFloat($("#shipping_fee_send_saler").val());
	// 供应商价格 - 发货总价
	$("#order_amount_send_saler").val(goods_price_send_saler*goods_number_send_saler + shipping_fee_send_saler);
}
</script>
	</body>
</html>